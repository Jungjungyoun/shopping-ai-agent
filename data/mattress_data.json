},\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": null,\n   \"metadata\": {\n    \"id\": \"load_data\"\n   },\n   \"outputs\": [],\n   \"source\": [\n    \"# ë°ì´í„° ë¡œë“œ ë° í™•ì¸\\n\",\n    \"with open('mattress_data.json', 'r', encoding='utf-8') as f:\\n\",\n    \"    mattress_data = json.load(f)\\n\",\n    \"\\n\",\n    \"# ë°ì´í„° êµ¬ì¡° í™•ì¸\\n\",\n    \"print(\\\"ë§¤íŠ¸ë¦¬ìŠ¤ ë°ì´í„° êµ¬ì¡°:\\\")\\n\",\n    \"for mattress in mattress_data['mattresses'][:2]:\\n\",\n    \"    print(f\\\"- {mattress['name']}: {mattress['type']}, {mattress['price']:,}ì›\\\")\\n\",\n    \"\\n\",\n    \"# DataFrameìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë°ì´í„° íƒìƒ‰\\n\",\n    \"df = pd.DataFrame(mattress_data['mattresses'])\\n\",\n    \"print(f\\\"\\\\nì´ {len(df)}ê°œì˜ ë§¤íŠ¸ë¦¬ìŠ¤ ë°ì´í„°\\\")\\n\",\n    \"print(f\\\"ë§¤íŠ¸ë¦¬ìŠ¤ íƒ€ì…: {df['type'].unique()}\\\")\\n\",\n    \"print(f\\\"ê°€ê²© ë²”ìœ„: {df['price'].min():,}ì› ~ {df['price'].max():,}ì›\\\")\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {\n    \"id\": \"rag_section\"\n   },\n   \"source\": [\n    \"## 3ï¸âƒ£ RAG ì‹œìŠ¤í…œ êµ¬ì¶•\\n\",\n    \"\\n\",\n    \"VectorDBë¥¼ ì‚¬ìš©í•´ ë§¤íŠ¸ë¦¬ìŠ¤ ì •ë³´ë¥¼ ì„ë² ë”©í•˜ê³  ê²€ìƒ‰ ê°€ëŠ¥í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": null,\n   \"metadata\": {\n    \"id\": \"rag_setup\"\n   },\n   \"outputs\": [],\n   \"source\": [\n    \"class MattressRAG:\\n\",\n    \"    def __init__(self):\\n\",\n    \"        # ì„ë² ë”© ëª¨ë¸ ì´ˆê¸°í™”\\n\",\n    \"        self.embedding_model = SentenceTransformer('all-MiniLM-L6-v2')\\n\",\n    \"        \\n\",\n    \"        # ChromaDB í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”\\n\",\n    \"        self.chroma_client = chromadb.Client()\\n\",\n    \"        \\n\",\n    \"        # ì»¬ë ‰ì…˜ ìƒì„±\\n\",\n    \"        try:\\n\",\n    \"            self.collection = self.chroma_client.create_collection(\\n\",\n    \"                name=\\\"mattress_collection\\\",\\n\",\n    \"                metadata={\\\"description\\\": \\\"ë§¤íŠ¸ë¦¬ìŠ¤ ì •ë³´ ë²¡í„° ì €ì¥ì†Œ\\\"}\\n\",\n    \"            )\\n\",\n    \"        except:\\n\",\n    \"            # ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš° ê°€ì ¸ì˜¤ê¸°\\n\",\n    \"            self.collection = self.chroma_client.get_collection(\\\"mattress_collection\\\")\\n\",\n    \"            self.chroma_client.delete_collection(\\\"mattress_collection\\\")\\n\",\n    \"            self.collection = self.chroma_client.create_collection(\\\"mattress_collection\\\")\\n\",\n    \"    \\n\",\n    \"    def add_documents(self, mattress_data):\\n\",\n    \"        \\\"\\\"\\\"ë§¤íŠ¸ë¦¬ìŠ¤ ë°ì´í„°ë¥¼ ë²¡í„° DBì— ì¶”ê°€\\\"\\\"\\\"\\n\",\n    \"        documents = []\\n\",\n    \"        metadatas = []\\n\",\n    \"        ids = []\\n\",\n    \"        \\n\",\n    \"        for mattress in mattress_data['mattresses']:\\n\",\n    \"            # ê²€ìƒ‰ìš© í…ìŠ¤íŠ¸ ìƒì„±\\n\",\n    \"            text = f\\\"\\\"\\\"\\n\",\n    \"            ë§¤íŠ¸ë¦¬ìŠ¤ëª…: {mattress['name']}\\n\",\n    \"            ë¸Œëœë“œ: {mattress['brand']}\\n\",\n    \"            íƒ€ì…: {mattress['type']}\\n\",\n    \"            ê°€ê²©: {mattress['price']:,}ì›\\n\",\n    \"            ê²½ë„: {mattress['firmness']}\\n\",\n    \"            íŠ¹ì§•: {', '.join(mattress['features'])}\\n\",\n    \"            ì¶”ì²œëŒ€ìƒ: {', '.join(mattress['recommended_for'])}\\n\",\n    \"            ì„¤ëª…: {mattress['description']}\\n\",\n    \"            \\\"\\\"\\\"\\n\",\n    \"            \\n\",\n    \"            documents.append(text.strip())\\n\",\n    \"            metadatas.append(mattress)\\n\",\n    \"            ids.append(mattress['id'])\\n\",\n    \"        \\n\",\n    \"        # ì„ë² ë”© ìƒì„±\\n\",\n    \"        embeddings = self.embedding_model.encode(documents).tolist()\\n\",\n    \"        \\n\",\n    \"        # ChromaDBì— ì¶”ê°€\\n\",\n    \"        self.collection.add(\\n\",\n    \"            embeddings=embeddings,\\n\",\n    \"            documents=documents,\\n\",\n    \"            metadatas=metadatas,\\n\",\n    \"            ids=ids\\n\",\n    \"        )\\n\",\n    \"        \\n\",\n    \"        print(f\\\"âœ… {len(documents)}ê°œì˜ ë§¤íŠ¸ë¦¬ìŠ¤ ì •ë³´ë¥¼ ë²¡í„° DBì— ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.\\\")\\n\",\n    \"    \\n\",\n    \"    def search(self, query: str, n_results: int = 3) -> List[Dict]:\\n\",\n    \"        \\\"\\\"\\\"ì¿¼ë¦¬ì— ë§ëŠ” ë§¤íŠ¸ë¦¬ìŠ¤ ê²€ìƒ‰\\\"\\\"\\\"\\n\",\n    \"        query_embedding = self.embedding_model.encode([query]).tolist()\\n\",\n    \"        \\n\",\n    \"        results = self.collection.query(\\n\",\n    \"            query_embeddings=query_embedding,\\n\",\n    \"            n_results=n_results\\n\",\n    \"        )\\n\",\n    \"        \\n\",\n    \"        return results['metadatas'][0]\\n\",\n    \"\\n\",\n    \"# RAG ì‹œìŠ¤í…œ ì´ˆê¸°í™”\\n\",\n    \"rag_system = MattressRAG()\\n\",\n    \"rag_system.add_documents(mattress_data)\\n\",\n    \"\\n\",\n    \"print(\\\"âœ… RAG ì‹œìŠ¤í…œ êµ¬ì¶• ì™„ë£Œ!\\\")\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": null,\n   \"metadata\": {\n    \"id\": \"test_rag\"\n   },\n   \"outputs\": [],\n   \"source\": [\n    \"# RAG ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸\\n\",\n    \"test_queries = [\\n\",\n    \"    \\\"í—ˆë¦¬í†µì¦ì— ì¢‹ì€ ë§¤íŠ¸ë¦¬ìŠ¤\\\",\\n\",\n    \"    \\\"ì €ë ´í•œ ê°€ê²©ì˜ ë§¤íŠ¸ë¦¬ìŠ¤\\\",\\n\",\n    \"    \\\"ë©”ëª¨ë¦¬í¼ ë§¤íŠ¸ë¦¬ìŠ¤\\\"\\n\",\n    \"]\\n\",\n    \"\\n\",\n    \"for query in test_queries:\\n\",\n    \"    print(f\\\"\\\\nğŸ” ê²€ìƒ‰ì–´: '{query}'\\\")\\n\",\n    \"    results = rag_system.search(query, n_results=2)\\n\",\n    \"    for i, result in enumerate(results, 1):\\n\",\n    \"        print(f\\\"  {i}. {result['name']} - {result['price']:,}ì›\\\")\"\n   ]\n  },\n  {\n   \"cell_type\": \"markdown\",\n   \"metadata\": {\n    \"id\": \"function_calling_section\"\n   },\n   \"source\": [\n    \"## 4ï¸âƒ£ Function Calling êµ¬í˜„\\n\",\n    \"\\n\",\n    \"AI Agentê°€ ì‚¬ìš©í•  í•¨ìˆ˜ë“¤ì„ ì •ì˜í•©ë‹ˆë‹¤.\"\n   ]\n  },\n  {\n   \"cell_type\": \"code\",\n   \"execution_count\": null,\n   \"metadata\": {\n    \"id\": \"function_definitions\"\n   },\n   \"outputs\": [],\n   \"source\": [\n    \"class MattressFunctions:\\n\",\n    \"    def __init__(self, rag_system, mattress_data):\\n\",\n    \"        self.rag = rag_system\\n\",\n    \"        self.data = mattress_data\\n\",\n    \"        self.df = pd.DataFrame(mattress_data['mattresses'])\\n\",\n    \"    \\n\",\n    \"    def search_mattress_by_criteria(self, \\n\",\n    \"                                   mattress_type: str = None,\\n\",\n    \"                                   max_price: int = None,\\n\",\n    \"                                   min_price: int = None,\\n\",\n    \"                                   firmness: str = None,\\n\",\n    \"                                   size: str = None) -> List[Dict]:\\n\",\n    \"        \\\"\\\"\\\"ì¡°ê±´ì— ë§ëŠ” ë§¤íŠ¸ë¦¬ìŠ¤ ê²€ìƒ‰\\\"\\\"\\\"\\n\",\n    \"        df_filtered = self.df.copy()\\n\",\n    \"        \\n\",\n    \"        if mattress_type:\\n\",\n    \"            df_filtered = df_filtered[df_filtered['type'].str.contains(mattress_type, case=False, na=False)]\\n\",\n    \"        \\n\",\n    \"        if max_price:\\n\",\n    \"            df_filtered = df_filtered[df_filtered['price'] <= max_price]\\n\",\n    \"        \\n\",\n    \"        if min_price:\\n\",\n    \"            df_filtered = df_filtered[df_filtered['price'] >= min_price]\\n\",\n    \"        \\n\",\n    \"        if firmness:\\n\",\n    \"            df_filtered = df_filtered[df_filtered['firmness'].str.contains(firmness, case=False, na=False)]\\n\",\n    \"        \\n\",\n    \"        if size:\\n\",\n    \"            df_filtered = df_filtered[df_filtered['size'].apply(lambda x: size in x)]\\n\",\n    \"        \\n\",\n    \"        return df_filtered.to_dict('records')\\n\",\n    \"    \\n\",\n    \"    def get_mattress_by_health_condition(self, condition: str) -> List[Dict]:\\n\",\n    \"        \\\"\\\"\\\"ê±´ê°• ìƒíƒœì— ë§ëŠ” ë§¤íŠ¸ë¦¬ìŠ¤ ì¶”ì²œ\\\"\\\"\\\"\\n\",\n    \"        condition_mapping = {\\n\",\n    \"            'í—ˆë¦¬í†µì¦': ['ë©”ëª¨ë¦¬í¼', 'ë¼í…ìŠ¤'],\\n\",\n    \"            'ê´€ì ˆì—¼': ['ë©”ëª¨ë¦¬í¼', 'ë¼í…ìŠ¤'],\\n\",\n    \"            'ë”ìœ„': ['ìŠ¤í”„ë§', 'í•˜ì´ë¸Œë¦¬ë“œ'],\\n\",\n    \"            'ì•Œë ˆë¥´ê¸°': ['ë¼í…ìŠ¤']\\n\",\n    \"        }\\n\",\n    \"        \\n\",\n    \"        recommended_types = []\\n\",\n    \"        for key, types in condition_mapping.items():\\n\",\n    \"            if key in condition:\\n\",\n    \"                recommended_types.extend(types)\\n\",\n    \"        \\n\",\n    \"        if not recommended_types:\\n\",\n    \"            return self.df.to_dict('records')\\n\",\n    \"        \\n\",\n    \"        filtered_df = self.df[self.df['type'].isin(recommended_types)]\\n\",\n    \"        return filtered_df.to_dict('records')\\n\",\n    \"    \\n\",\n    \"    def get_budget_recommendations(self, budget: int) -> Dict:\\n\",\n    \"        \\\"\\\"\\\"ì˜ˆì‚°ë³„ ë§¤íŠ¸ë¦¬ìŠ¤ ì¶”ì²œ\\\"\\\"\\\"\\n\",\n    \"        budget_df = self.df[self.df['price'] <= budget].sort_values('price')\\n\",\n    \"        \\n{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "title"
   },
   "source": [
    "# ğŸ›ï¸ ë§¤íŠ¸ë¦¬ìŠ¤ êµ¬ë§¤ ê°€ì´ë“œ AI Agent\n",
    "\n",
    "**ëª©í‘œ**: Function Callingê³¼ RAGë¥¼ í™œìš©í•œ ê°œì¸ ë§ì¶¤í˜• ë§¤íŠ¸ë¦¬ìŠ¤ ì¶”ì²œ AI Agent ê°œë°œ\n",
    "\n",
    "## ğŸ“‹ í”„ë¡œì íŠ¸ êµ¬ì„±\n",
    "1. **í™˜ê²½ ì„¤ì • ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜**\n",
    "2. **ë°ì´í„° ì¤€ë¹„ ë° RAG ì‹œìŠ¤í…œ êµ¬ì¶•**\n",
    "3. **Function Calling êµ¬í˜„**\n",
    "4. **AI Agent ê°œë°œ**\n",
    "5. **Streamlit ì±—ë´‡ ì¸í„°í˜ì´ìŠ¤**\n",
    "6. **í…ŒìŠ¤íŠ¸ ë° í‰ê°€**\n",
    "\n",
    "---"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "setup"
   },
   "source": [
    "## 1ï¸âƒ£ í™˜ê²½ ì„¤ì • ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "install_packages"
   },
   "outputs": [],
   "source": [
    "# í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜\n",
    "!pip install -q openai chromadb sentence-transformers pandas numpy\n",
    "!pip install -q streamlit gradio pyngrok\n",
    "!pip install -q langchain langchain-openai langchain-community"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "imports"
   },
   "outputs": [],
   "source": [
    "import json\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import chromadb\n",
    "import openai\n",
    "from sentence_transformers import SentenceTransformer\n",
    "import streamlit as st\n",
    "import gradio as gr\n",
    "from typing import List, Dict, Any, Optional\n",
    "import os\n",
    "import warnings\n",
    "warnings.filterwarnings('ignore')\n",
    "\n",
    "print(\"âœ… ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì„±ê³µì ìœ¼ë¡œ importë˜ì—ˆìŠµë‹ˆë‹¤!\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "api_setup"
   },
   "outputs": [],
   "source": [
    "# OpenAI API í‚¤ ì„¤ì • (ì—¬ëŸ¬ë¶„ì˜ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”)\n",
    "# OpenAI API í‚¤ê°€ ì—†ë‹¤ë©´ Hugging Faceì˜ ë¬´ë£Œ ëª¨ë¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤\n",
    "\n",
    "OPENAI_API_KEY = \"your-openai-api-key-here\"  # ì—¬ê¸°ì— ì‹¤ì œ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”\n",
    "\n",
    "# API í‚¤ê°€ ì—†ëŠ” ê²½ìš°ë¥¼ ìœ„í•œ ëŒ€ì•ˆ ì„¤ì •\n",
    "USE_OPENAI = OPENAI_API_KEY != \"your-openai-api-key-here\"\n",
    "\n",
    "if USE_OPENAI:\n",
    "    openai.api_key = OPENAI_API_KEY\n",
    "    print(\"âœ… OpenAI API ì„¤ì • ì™„ë£Œ\")\n",
    "else:\n",
    "    print(\"âš ï¸ OpenAI API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. Hugging Face ëª¨ë¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.\")\n",
    "    print(\"ì‹¤ì œ ì‚¬ìš© ì‹œì—ëŠ” OpenAI API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "id": "data_section"
   },
   "source": [
    "## 2ï¸âƒ£ ë°ì´í„° ì¤€ë¹„ ë° ë¡œë“œ\n",
    "\n",
    "**ì£¼ì˜**: ì‹¤ì œ ì‚¬ìš© ì‹œì—ëŠ” ë‹¤ìš´ë¡œë“œë°›ì€ JSON íŒŒì¼ë“¤ì„ ì½”ë©ì— ì—…ë¡œë“œí•˜ê±°ë‚˜ Google Driveì—ì„œ ë¶ˆëŸ¬ì™€ì•¼ í•©ë‹ˆë‹¤."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "create_sample_data"
   },
   "outputs": [],
   "source": [
    "# ìƒ˜í”Œ ë°ì´í„° ìƒì„± (ì‹¤ì œë¡œëŠ” ë‹¤ìš´ë¡œë“œí•œ íŒŒì¼ì„ ì‚¬ìš©í•˜ì„¸ìš”)\n",
    "sample_mattress_data = {\n",
    "    \"mattresses\": [\n",
    "        {\n",
    "            \"id\": \"ikea_hafslo\",\n",
    "            \"name\": \"IKEA HÃ„FSLO ë§¤íŠ¸ë¦¬ìŠ¤\",\n",
    "            \"brand\": \"IKEA\",\n",
    "            \"type\": \"ìŠ¤í”„ë§\",\n",
    "            \"price\": 179000,\n",
    "            \"size\": [\"ì‹±ê¸€\", \"ë”ë¸”\", \"í€¸\", \"í‚¹\"],\n",
    "            \"firmness\": \"ì¤‘ê°„\",\n",
    "            \"features\": [\"í†µê¸°ì„± ìš°ìˆ˜\", \"ë…ë¦½ìŠ¤í”„ë§\", \"ì²œì—°ë¼í…ìŠ¤\"],\n",
    "            \"recommended_for\": [\"í‰ê·  ì²´ì¤‘\", \"ëª¨ë“  ìˆ˜ë©´ìì„¸\"],\n",
    "            \"description\": \"525ê°œ ë…ë¦½ìŠ¤í”„ë§ê³¼ ì²œì—°ë¼í…ìŠ¤ ì¸µìœ¼ë¡œ êµ¬ì„±ëœ ë§¤íŠ¸ë¦¬ìŠ¤\"\n",
    "        },\n",
    "        {\n",
    "            \"id\": \"memory_foam_premium\",\n",
    "            \"name\": \"í”„ë¦¬ë¯¸ì—„ ë©”ëª¨ë¦¬í¼ ë§¤íŠ¸ë¦¬ìŠ¤\",\n",
    "            \"brand\": \"ì˜¤ëŠ˜ì˜ì§‘\",\n",
    "            \"type\": \"ë©”ëª¨ë¦¬í¼\",\n",